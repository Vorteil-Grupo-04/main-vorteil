<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="StyleDashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Gloock&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Gloock&display=swap" rel="stylesheet">
    <script src="cadastro.js"></script>
    <script src="CRUDempresa.js"></script>
    <script src="./alertas.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Gloock&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Gloock&display=swap" rel="stylesheet">
    <link rel="icon" href="./assets/logo-nome-vorteil.png" type="image/x-icon">
    <title>Dashboard</title>
</head>
      
<body onload="scriptInicializacao()">
  <div class="container" id="pai">
      <div class="lateral" >
        <div class="contLat">
          <div class="userCont">
              <div class="profilePai">
                  <img src="./assets/gray-user-profile-icon-png-fP8Q1P.png" alt="" class="profile">
              </div>
              <p class="textoDefault">Bem vindo, <span id="usuarioNome">usuario</span></p>
          </div>
          <div  onclick="modalUm()"  class="botaoAcesso" id="botaoUm"><p class="textoDefault">Dashboard</p> </div>
          <div  onclick="modalDois()" class="botaoAcesso"  id="botaoDois"><p class="textoDefault">Clima</p> </div>
        </div>
        <div class="contLat">
         
          <div onclick="modalCinco()" class="botaoAcesso"  id="botaoCinco"><p class="textoDefault">Configurações</p> </div>
          <div  onclick="exit()" class="botaoAcesso" id="botaoSeis"><p class="textoDefault" >Sair</p> </div>
        </div>

      </div>
      <div class="conteudo" id="conteudoUm" >
          <div class="conjuntoKPI" style="font-size: 22px;">
              <div class="kpi" style="width:calc((100% / 2 ))"><h2  id="piorEmpresa">TAM</h2><h1>É a empresa com o maior índice de cancelamentos.</h1> <h1 id="dadosEmpresa"></h1></div>
              <div class="kpi" style="width:calc((100% / 2 ))"><h2  id="piorAeroporto">GOL</h2><h1>É o Aeroporto com o maior índice de cancelamentos.</h1> <h1 id="dadosAeroporto"></h1></div>
             
          </div>
         <div class="conjuntoFinal">
          <div class="dashAlign">
            <p class="sub" style="font-weight: 500; margin-left: 40%">Maiores índices registrados por empresa</p>
<div class="conjuntoDashboard" style="flex-direction: row; gap: 0;" >
<div class="dashAreasDois" style="border-radius: 0;">
  <canvas style="width: 600px; border-radius: 0;" class="grafic" id="myChart"></canvas>

</div>
<div class="dashAreasDois" style="border-radius: 0;">
<canvas style="width: 600px; border-radius: 0;" class="grafic" id="myChartDois"></canvas>

</div>
</div>
          </div>
          <div class="dashAlign">
              <div style="
              align-content: space-between;
              justify-content: space-between;
              display: flex;
              width: 100%;
                ">
                <p class="sub" style="font-weight: 500; margin-left: 15%">Índice de reclamações registradas</p>
                <p class="sub" style="font-weight: 500; margin-right: 15%">Meio de envio das reclamações</p>
              </div>

          <div class="conjuntoDashboard"  style="flex-direction: row;" >
            <div class="dashAreasDois">
              <canvas style="width: 600px; border-radius: 0;" class="grafic" id="myChartTres"></canvas>


            </div>
          <div class="dashAreasDois">
            <canvas style="width: 600px;" class="grafic" id="myChartQuatro"></canvas>

          </div>
        </div>
      </div>
         
       
         </div>
      </div>
      <div class="conteudo dis" id="conteudoDois" style="align-items: center; justify-content: center; ">
       
        <div class="conjuntoFinal modify" style="flex-direction: column; align-items: center;"><br><br>
    <div class="alinhator" style="flex-direction: row;">
      <div class="alinhator">
        <label for="">Saída</label>
        <input type="text" name="" id="input_saida_clima">
      </div>
      <div class="alinhator">
        <label for="">Destino</label>
        <input type="text" name="" id="input_destino_clima">
      </div>
      <div style="justify-content: flex-end; height: 100%;" class="alinhator">
        <button class="clima-api-button" onclick="climaAPI()">Consultar</button>
    </div>
    </div><br>
      <div class="alinhator">
      <p>Previsões - Saídas</p>
     <div class="alignCard" style="width: auto; gap: 2.5rem; height: auto; display: flex; align-items: center; justify-content: center;">
      <div id="saida1" class="card"></div>
      <div id="saida2" class="card"></div>
      <div id="saida3" class="card"></div>
      <div id="saida4" class="card"></div>
      <div id="saida5" class="card"></div>
     </div>
    </div>
    <div class="alinhator">
      <p>Previsões - Destino</p>
     <div class="alignCard" style="width: auto; gap: 2.5rem; height: auto; display: flex; flex-direction: row; align-items: center; justify-content: center;">
      <div id="destino1" class="card"></div>
      <div id="destino2" class="card"></div>
      <div id="destino3" class="card"></div>
      <div id="destino4" class="card"></div>
      <div id="destino5" class="card"></div>
     </div>
    </div>
         </div>
        
             </div>
             <div class="conteudo dis" id="conteudoQuatro" style="flex-direction: row;">
       
              <div class="conjuntoFinal">
               <div class="conjuntoDashboard">
                   <div class="dashAreas" style="align-items: start; padding-left: 2rem;">
                     <h1 class="titulin">Conselho da IA</h1>
                     <p class="titulinho">A rota aérea São Paulo - Ceará conecta a capital paulista a Fortaleza, famosa por suas praias e cultura. O tempo de voo direto é de cerca de 3 horas e 30 minutos. Companhias como LATAM, Gol e Azul operam essa rota, partindo principalmente do Aeroporto Internacional de Guarulhos (GRU). O Aeroporto Pinto Martins (FOR) é o principal ponto de chegada em Fortaleza. A demanda é alta tanto para negócios quanto para turismo, especialmente na alta temporada. Reservas antecipadas e atenção às políticas de bagagem são recomendadas.
   
   
   
                     </p>
                
                   </div>
                   <div class="dashAreasDois" style="align-items: start; padding-left: 2rem;">
                     <h1 class="titulin">Consideações finais</h1>
                     <p class="titulinho">Com isso afirmo que tem rotas que precisam ser analisadas antes de tomar a decisâo final.</p>
   
                   </div>
               </div>
               <div class="kpiTotal" style="flex-direction: column; gap: 0.5rem; " >
                 <div class="kpi" style="width: calc(100% - 1rem); height: calc((100% / 4) - 0.5rem); flex-direction: column; gap: 8px; font-family:sans-serif;"><h1 class="titulin">Destaques</h1><p class="titulinho">destaque 1</p></div>
                 <div class="kpi" style="width: calc(100% - 1rem); height: calc((100% / 4) - 0.5rem); flex-direction: column; gap: 8px;font-family:sans-serif;"><h1 class="titulin">Destaques</h1><p class="titulinho">destaque 1</p></div>
                 <div class="kpi" style="width: calc(100% - 1rem); height: calc((100% / 4) - 0.5rem); flex-direction: column; gap: 8px;font-family:sans-serif;"><h1 class="titulin">Destaques</h1><p class="titulinho">destaque 1</p></div>
                 <div class="kpi" style="width: calc(100% - 1rem); height: calc((100% / 4) - 0.5rem); flex-direction: column; gap: 8px;font-family:sans-serif;"><h1 class="titulin">Destaques</h1><p class="titulinho">destaque 1</p></div>
               </div>
              </div>
           </div>
           <div class="conteudo dis" id="conteudoCinco">
               <div class="conjuntoKPI" style="flex-direction: column;">
                   <div class="kpi"></div>
                   <div class="kpi"></div>
                   <div class="kpi"></div>
                   <div class="kpi"></div>
   
          
               </div>
              <div class="conjuntoFinal">
               <div class="conjuntoDashboard">
                   <div class="dashAreas" style="background-color: blue;"></div>
                   <div class="dashAreasDois"></div>
               </div>
               <div class="kpiTotal"></div>
              </div>
           </div>
           <div class="conteudo dis" id="conteudoSeis">
              <div class="conjuntoFinal">
               <div class="conjuntoDashboard" style="flex-direction: row;">
                   <div class="dashArea" style="background-color: rgba(0, 0, 255, 0); padding: 0; gap: 0.5rem; align-items: center; justify-content: center; display: flex; flex-direction: column; height: 100%; width: 100%;">
                     <div class="changeMode"  onclick="empHidden()" style="border: 1px solid white;" ><p class="textoDefault">Empresa</p></div>
                     <div class="hidden dis" id="empHidden" style="width: 50%;">
                        <div class="changeMode list"  onclick="addEmp()" style="border: 1px solid white;" ><p class="textoDefault">Adicionar empresa</p></div>
                     <div class="changeMode list" onclick="ediEmp(),listarDados()" style="border: 1px solid white;"><p class="textoDefault">Editar empresa</p></div>
                     <div class="changeMode exclu" onclick="delEmp(),listarDados()" style="border: 1px solid white;"><p class="textoDefault" >Deletar empresa</p></div>
                     </div>
                     <div class="changeMode"  onclick="tokenHidden()" style="border: 1px solid white;" ><p class="textoDefault">Token</p></div>
                     <div class="hidden dis" id="tokenHidden" style="width: 50%;">
                        <div class="changeMode list"  onclick="addToken()" style="border: 1px solid white;" ><p class="textoDefault">Adicionar token</p></div>
                     <div class="changeMode list" onclick="ediToken()" style="border: 1px solid white;"><p class="textoDefault">Editar token</p></div>
                     <div class="changeMode list" onclick="selectTokenMod()" style="border: 1px solid white;"><p class="textoDefault" >ver token</p></div>
                     <div class="changeMode exclu" onclick="delToken()" style="border: 1px solid white;"><p class="textoDefault" >Deletar token</p></div>
                     </div>
                     <div class="changeMode"  onclick="userHidden(), listarDadosUsuario()" style="border: 1px solid white;" ><p class="textoDefault">Usuário</p></div>
                     <div class="hidden dis" id="userHidden" style="width: 50%;">
                      <div class="changeMode list" onclick="mostrarModalCrud(4)" style="border: 1px solid white;"><p class="textoDefault" >Editar usuário</p></div>
                      <div class="changeMode exclu"  onclick="delUser(), listarDadosUsuario()" style="border: 1px solid white;"><p class="textoDefault">Remover usuário</p></div>
                     </div>
                    
                   </div>
                   <div class="dashAreasDois" style="color: #1d1d1d; height: 100%; width: 100%;">
                    <div class="cadastroEmp" id="cadEmp">
                      <h1 class="titulo">Adicionar empresa</h1>
                      <div class="align">
                          <div class="alignForm">
                              <p>Nome Fantasia</p>
                              <input type="text" class="ipt" id="input_nome_empresa_cadastro">
                            </div>
                            <div class="alignForm">
                              <p>Razão Social</p>
                              <input type="text" class="ipt" id="input_razao_social_cadastro">
                            </div>
                            <div class="alignForm">
                              <p>CNPJ</p>
                              <input type="text" class="ipt" id="input_cnpj_cadastro" maxlength="18" oninput="formatarCNPJ(this)">
                            </div>
                            <div class="alignForm">
                              <p>Cidade</p>
                              <input type="text" id="input_cidade_cadastro" class="ipt">
                            </div>
                            <div class="align">
                              <div class="btnConfirmar" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;"
                                onclick="btnCadastroEmpresa()">
                                <p>Enviar</p>
                              </div>
                             
                          </div>
                      </div>
                  </div>
                  <div class="cadastroEmp" id="editUser">
                    <h1 class="titulo">Editar usuario</h1>
                    <div class="align">
                        <div class="alignForm">
                          <p>Nome</p>
                          <input type="text" class="ipt" id="input_nome_usuario_editar">
                        </div>
                        <div class="alignForm">
                            <p>E-mail</p>
                            <input type="text" id="input_email_usuario_editar" class="ipt">
                        </div>
                        <div class="align">
                          <div class="btnConfirmar" id="btnEdit2" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;" onclick="habilitarEdicaoUsuario()"><p>Editar</p></div>
                          <div class="btnConfirmar" id="btnEnviar2" style="display: none; width: 100px; height: 35px; margin-top: 8px; cursor: pointer;"
                              onclick="enviarEdicaoUsuario()">
                              <p>Enviar</p>
                              </div>
                        </div>
                        
                    </div>
                </div>
                  <div class="cadastroEmp" id="editEmp">
                      <h1 class="titulo">Editar empresa</h1>
                      <div class="align">
                          <div class="alignForm">
                            <p>Nome Fantasia</p>
                            <input type="text" class="ipt" id="input_nome_empresa_editar">
                          </div>
                          <div class="alignForm">
                            <p>Razão Social</p>
                            <input type="text" class="ipt" id="input_razao_social_editar">
                          </div>
                          <div class="alignForm">
                            <p>CNPJ</p>
                            <input type="text" class="ipt" id="input_cnpj_editar" maxlength="18" oninput="formatarCNPJ(this)">
                          </div>
                          <div class="alignForm">
                            <p>Cidade</p>
                            <input type="text" class="ipt" id="input_cidade_editar">
                          </div>
                          <div class="align">
                            <div class="btnConfirmar" id="btnEdit" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;"
                              onclick="habilitarEdicao()">
                              <p>Editar</p>
                              </div>
  
                              <div class="btnConfirmar" id="btnEnviar" style="display: none; width: 100px; height: 35px; margin-top: 8px; cursor: pointer;"
                              onclick="enviarEdicao()">
                              <p>Enviar</p>
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="cadastroEmp" id="delEmp">
                    <h1 class="titulo">Remover empresa</h1>
                    <div class="alignForm">
                      <p>Sua empresa:</p>
                      <input type="text" class="ipt" id="input_nome_empresa_deletar">
                    </div>
                    <button class="btnConfirmar" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;" onclick="removerEmpresa()">Remover</button>
                  </div>
                  <div class="cadastroEmp" id="delUser">
                    <h1 class="titulo">Remover seu usuário</h1>
                    <div class="alignForm">
                      <p>Será removido:</p>
                      <input type="text" class="ipt" id="input_nome_usuario_deletar">
                    </div>
                    <button class="btnConfirmar" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;" onclick="removerUsuario()">Remover</button>
                  </div>
                   <div class="cadastroEmp" id="delToken">
                    <h1 class="titulo">Excluir token</h1>
                    <input type="text" id="input_deleteToken">
                    <button  id="deleteToken" class="btnConfirmar" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;" onclick="deletarToken()">Excluir</button>
                  </div>
                  <div class="cadastroEmp" id="addToken">
                    <h1 class="titulo">Adicionar token</h1>
                    <button id="insertToken" class="btnConfirmar" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;">Adicionar</button>
                  </div>
                  <div class="cadastroEmp" id="ediToken">
                    <h1 class="titulo">Editar token</h1>
                    <input type="text" id="input_updateToken">
                    <button id="ativarToken" class="btnConfirmar" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;" onclick="ativarToken()">Ativar</button>
                    <button id="desativarToken" class="btnConfirmar" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;" onclick="desativarToken()">Desativar</button>

                  </div>
                  <div class="cadastroEmp" id="selectToken">
                    <h1 class="titulo">Select token</h1>
                    <input type="text" id="input_selectToken">
                    <button  id="selectToken" class="btnConfirmar" style="width: 100px; height: 35px; margin-top: 8px; cursor: pointer;" onclick="selectToken()">Mostrar</button>
                    <div class="align">
                      <p id="expiracaoExibir"></p>
                      <p id="statusExibir"></p>

                    </div>
                    
                  </div>
               </div>
                    
               </div>
              </div>
           </div>
        
       </div>





       <div id="botaoFechar" class="fechar none" style="background-color: red; width: 50px; height: 50px; border-radius: 100px; justify-content: center; position: absolute; z-index: 1000; right: 50px;" onclick="fecharModals()"><p>fechar</p></div>


       <div class="close" id="closeIcon" onclick="closeMod()">   <nav id="nav" class="nav invi" style="align-items: center; gap: 1rem; justify-content: center; flex-direction: column;" >
        <input id="saida" type="text">
        <input id="destino" type="text">
        <div class="align" style="display: flex; flex-direction: row; gap: 1rem;">
          <button id="APIquest1" onclick="enviarPrompt(1)" class="btnConfirmar" style="width: 600px; height: 100px;">Com base no histórico de voos entre a saida e o destino, quais são as chances de atrasos para diferentes companhias aéreas? Quais delas têm o melhor histórico de pontualidad</button>
          <button id="APIquest2" onclick="enviarPrompt(2)" class="btnConfirmar" style="width: 600px; height: 100px;">Qual a faixa etaria de pessoas que costumam fazer viagens aéreas para destino</button>
          <button id="APIquest3" onclick="enviarPrompt(3)" class="btnConfirmar" style="width: 600px; height: 100px;">Quais empresas aéreas fazem o voo com a rota saida para destino</button>
        </div>
       
        <div id="resposta"></div>
     </nav></div>
     <div class="lateralDireita hidden" id="latDir">
       <div class="formContent">
           <label for="" class="informativo">Local de saida</label>
           <input type="text" placeholder="Digite aqui">
       </div>
   
       <div class="formContent">
           <label for="" class="informativo">Local de destino</label>
           <input type="text" placeholder="Digite aqui">
       </div>
   
       <div class="formContent">
           <label for="" class="informativo">Horário de partida</label>
           <input type="text" placeholder="Digite aqui">
       </div>
   
       <div class="formContent">
           <label for="" class="informativo">Previsâo de chegada</label>
           <input type="text" placeholder="Digite aqui">
       </div>
   
       <div class="formContent">
           <label for="" class="informativo">Media de passageiros</label>
           <select name="" id="">
               <option value="">Um</option>
               <option value="">Um</option>
               <option value="">Um</option>
               <option value="">Um</option>
           </select>
       </div>
   
       <div class="formContent">
           <label for="" class="informativo">Aeroporto de saida</label>
           <input type="text" placeholder="Digite aqui">
       </div>
       <div class="formContent">
           <label for="" class="informativo">Deseja a ajuda de inteligencia artifical?</label>
           <div class="formContentAlt">
               <label for="" class="informativo">Sim
                   <input
                   type="checkbox"
                   id="subscribeNews"
                   name="subscribe"
                   value="newsletter" />
               </label>
               <label for="" class="informativo">Nâo
                   <input
                   type="checkbox"
                   id="subscribeNews"
                   name="subscribe"
                   value="newsletter" />
               </label>
        
       </div>
   
      
    
       </div>
       <div class="formContent">
           <div class="btnConfirmar"><p>Confirmar</p></div>
       </div>
      
   
   </div>
   
      </div>
     
      <div id="alertaNotify" class="alertaNotify">
        <div id="textoDentro" class="textoDentro">div inicial</div>
      </div>
 
</body>
</html>

<script>

  function exibirIA(params) {
    document.getElementById('userHidden').style.display = 'flex ';
    var caixaUser = document.getElementById('userHidden')
    var caixaUser = document.getElementById('userHidden')
  }
//para atribuir o nome ao usuario quando fizer login
const usuarioNomeCompleto = sessionStorage.getItem('NOME_USUARIO');

if (usuarioNomeCompleto) {
  const primeiraPalavra = usuarioNomeCompleto.split(" ")[0];
  document.getElementById('usuarioNome').textContent = primeiraPalavra + '!';
}

function scriptInicializacao(){

  sessionStorage.tamanhoListaNotificacao = 0;
      validarUsuario()
      puxarGraficos()
  setInterval( () => {
  chamarNotificar()
  }, 350000000000);

}
var hasASUDO = false;
  var empresaUmCancelamentos;
  var empresaUmNome;
  var empresaDoisCancelamentos;
  var empresaDoisNome;
  var empresaTresCancelamentos;
  var empresaTresNome;
  var empresaQuatroCancelamentos;
  var empresaQuatroNome;
  var empresaCincoCancelamentos;
  var empresaCincoNome;
  var empresaSeisCancelamentos;
  var empresaSeisNome;
  var empresaUmAtrasos;
  var empresaDoisAtrasos;
  var empresaTresAtrasos;
  var empresaQuatroAtrasos;
  var empresaCincoAtrasos;
  var empresaSeisAtrasos;
  var empresaAereaAtrasoNomeUm;
  var empresaAereaAtrasoNomeDois;
  var empresaAereaAtrasoNomeTres;
  var empresaAereaAtrasoNomeQuatro;
  var empresaAereaAtrasoNomeCinco;
  var empresaAereaAtrasoNomeSeis;
  var internet;
  var lojaFisica;
  var telefone;
  var internetNumero;
  var telefoneNumero;
  var lojaFisicaNumero;
  // Definindo as variáveis para as faixas etárias
var faixaEtariaUm; // Exemplo de faixa etária
var faixaEtariaDois; // Exemplo de faixa etária
var faixaEtariaTres; // Exemplo de faixa etária
var faixaEtariaQuatro; // Exemplo de faixa etária
var faixaEtariaCinco; // Exemplo de faixa etária

// Definindo as variáveis para os dados das faixas etárias
var fxUm; // Exemplo de valor de dados para a faixa etária 18-24
var fxDois; // Exemplo de valor de dados para a faixa etária 25-34
var fxTres; // Exemplo de valor de dados para a faixa etária 35-44
var fxQuatro; // Exemplo de valor de dados para a faixa etária 45-54
var fxCinco; // Exemplo de valor de dados para a faixa etária 55+
function exit(){
  sessionStorage.clear();
  window.location = "Cadastro.html"


}
var status;
var expiration;
  var aeroportoUmCancelamentos;
  var aeroportoUmNome;
  var aeroportoDoisCancelamentos;
  var aeroportoDoisNome;
  var aeroportoTresCancelamentos;
  var aeroportoTresNome;
  var aeroportoQuatroCancelamentos;
  var aeroportoQuatroNome;
  var aeroportoCincoCancelamentos;
  var aeroportoCincoNome;
  var aeroportoSeisCancelamentos;
  var aeroportoSeisNome;
  var aeroportoUmAtrasos;
  var aeroportoDoisAtrasos;
  var aeroportoTresAtrasos;
  var aeroportoQuatroAtrasos;
  var aeroportoCincoAtrasos;
  var aeroportoSeisAtrasos;
  var tipoCargo;
  function cargo() {
    
    fetch("../usuarios/cargo", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
          idServer: sessionStorage.ID_USUARIO,
      })
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
        console.log('estou aqui');
        
  
        if (resposta.ok) {
      setTimeout(() => {
        resposta.json().then(json => {
          console.log(json);
          tipoCargo = json[0].nome_cargo

          
        })
        
          }, 500);

          
 
        } else {
          throw "Houve um erro ao trazer dados!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  
    return false;
  
  }
  function comoComprou() {
    
    fetch("../dashboard/comoComprou", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      }
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
        console.log('estou aqui');
        
  
        if (resposta.ok) {
      setTimeout(() => {
        resposta.json().then(json => {
          console.log(json);
          internet = json[0].comoComprouContratou
          lojaFisica = json[1].comoComprouContratou
          telefone = json[2].comoComprouContratou
          internetNumero = json[0].frequency
          lojaFisicaNumero = json[1].frequency
          telefoneNumero = json[2].frequency

          console.log(internetNumero)
          console.log(telefoneNumero)
          console.log(lojaFisicaNumero)

          
        })
        
          }, 500);

          
 
        } else {
          throw "Houve um erro ao trazer dados!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  
    return false;
  
  }

  function faixaEtaria() {
    
    fetch("../dashboard/faixaEtaria", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      }
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
        console.log('estou aqui');
        
  
        if (resposta.ok) {
      setTimeout(() => {
        resposta.json().then(json => {
          console.log(json);
           faixaEtariaUm = json[0].faixaEtaria;
 faixaEtariaDois = json[1].faixaEtaria;
 faixaEtariaTres = json[2].faixaEtaria;
 faixaEtariaQuatro = json[3].faixaEtaria;
 faixaEtariaCinco = json[4].faixaEtaria;
 fxUm = json[0].frequency; // 150
 fxDois = json[1].frequency; // 200
 fxTres = json[2].frequency; // 120
 fxQuatro = json[3].frequency; // 180
 fxCinco = json[4].frequency; // 90
console.log('aqui'+fxCinco, fxUm)

        
          
        })
        
          }, 500);
 
        } else {
          throw "Houve um erro ao trazer dados!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  
    return false;
  
  }

    function puxarDadosKPI() {
    
    fetch("../dashboard/puxarDadosKPI", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      }
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
        console.log('estou aqui');
        
  
        if (resposta.ok) {
      setTimeout(() => {
        resposta.json().then(json => {
          console.log(json);
          console.log('atrasos aeroporto')
          piorEmpresa.innerHTML = json[0].empresaAerea.slice(0, 3)
          dadosEmpresa.innerHTML = `Tendo <span style="font-size: 20px; color: red">${json[0].mediaCancelamentos.toFixed(1)}%</span> dos seus voos registrados cancelados.`
          piorEmpresa = json[0].empresaAerea
          piorEmpresaDado = json[0].mediaCancelamentos

          
        })
        
          }, 2000);
 
        } else {
          throw "Houve um erro ao trazer dados!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  
    return false;
  
  }
  function puxarDadosKPIAero() {
    
    fetch("../dashboard/puxarDadosKPIAero", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      }
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
        console.log('estou aqui');
        
  
        if (resposta.ok) {
      setTimeout(() => {
        resposta.json().then(json => {
          console.log(json);
          console.log('atrasos aeroporto')
          piorAeroporto.innerHTML = json[0].nomeAeroportoSaida.slice(0, 14)
          dadosAeroporto.innerHTML = ` Tendo <span style="font-size: 20px; color: red">${json[0].mediaCancelamentos.toFixed(1)}%</span> dos seus voos registrados cancelados.`
          piorEmpresa = json[0].empresaAerea
          piorEmpresaDado = json[0].mediaCancelamentos

          
        })
        
          }, 2000);
 
        } else {
          throw "Houve um erro ao trazer dados!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  
    return false;
  
  }

  

function atrasosAeroportos() {
    
    fetch("../dashboard/atrasosAeroporto", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      }
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
        console.log('estou aqui');
        
  
        if (resposta.ok) {
      setTimeout(() => {
        resposta.json().then(json => {
          console.log(json);
          console.log('atrasos aeroporto')
          aeroportoUmAtrasos = json[0].mediaAtrasoSuperior30
          aeroportoDoisAtrasos = json[1].mediaAtrasoSuperior30
          aeroportoTresAtrasos = json[2].mediaAtrasoSuperior30
          aeroportoQuatroAtrasos = json[3].mediaAtrasoSuperior30
          aeroportoCincoAtrasos = json[4].mediaAtrasoSuperior30
          aeroportoSeisAtrasos = json[5].mediaAtrasoSuperior30
          
        })
        
          }, 500);
 
        } else {
          throw "Houve um erro ao trazer dados!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  
    return false;
  
  }
  
  function atrasosEmpresa() {
    
    fetch("../dashboard/atrasosEmpresa", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      }
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
        console.log(resposta.empresaAerea)
  
        if (resposta.ok) {
      setTimeout(() => {
        resposta.json().then(json => {
          console.log(json);
          empresaUmAtrasos = json[0].mediaAtrasoSuperior30
          empresaAereaAtrasoNomeUm = json[0].empresaAerea
          empresaAereaAtrasoNomeDois = json[1].empresaAerea
          empresaAereaAtrasoNomeTres = json[2].empresaAerea
          empresaAereaAtrasoNomeQuatro = json[3].empresaAerea
          empresaAereaAtrasoNomeCinco = json[4].empresaAerea
          empresaAereaAtrasoNomeSeis = json[5].empresaAerea
          empresaDoisAtrasos = json[1].mediaAtrasoSuperior30
          empresaTresAtrasos = json[2].mediaAtrasoSuperior30
          empresaQuatroAtrasos = json[3].mediaAtrasoSuperior30
          empresaCincoAtrasos = json[4].mediaAtrasoSuperior30
          empresaSeisAtrasos = json[5].mediaAtrasoSuperior30
          
        })
        
          }, 500);
 
        } else {
          throw "Houve um erro ao trazer dados!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  
    return false;
  
  }
  async function cancelamentosEmpresa() {
    console.log("Entrei");
    
  try {
    const resposta = await fetch("../dashboard/cancelamentosEmpresa", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      }
    });

    // console.log("resposta: ", resposta);

    if (resposta.ok) {
      setTimeout(() => {
        resposta.json().then(json => {
          console.log(json);
          empresaUmNome = json[0].empresaAerea
          empresaUmCancelamentos = json[0].mediaCancelamentos
          empresaDoisNome = json[1].empresaAerea
          empresaDoisCancelamentos = json[1].mediaCancelamentos
          empresaTresNome = json[2].empresaAerea
          empresaTresCancelamentos = json[2].mediaCancelamentos
          empresaQuatroNome = json[3].empresaAerea
          empresaQuatroCancelamentos = json[3].mediaCancelamentos
          empresaCincoNome = json[4].empresaAerea
          empresaCincoCancelamentos = json[4].mediaCancelamentos
          empresaSeisNome = json[5].empresaAerea
          empresaSeisCancelamentos = json[5].mediaCancelamentos


          console.log(empresaUmNome, empresaUmCancelamentos);
      
        })
        

      }, 500); // O tempo é em milissegundos, então 2000 = 2 segundos
    } else {
      throw new Error("Houve um erro ao trazer dados!");
    }
  } catch (erro) {
    console.log(`#ERRO: ${erro}`);
  }

  return false;
}

  function cancelamentosAeroporto() {
    
    fetch("../dashboard/cancelamentosAeroporto", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      }
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
  
        if (resposta.ok) {
      setTimeout(() => {
        resposta.json().then(json => {
          console.log(json);
          aeroportoUmNome = json[0].nomeAeroportoSaida
          aeroportoUmCancelamentos = json[0].mediaCancelamentos
          aeroportoDoisNome = json[1].nomeAeroportoSaida
          aeroportoDoisCancelamentos = json[1].mediaCancelamentos
          aeroportoTresNome = json[2].nomeAeroportoSaida
          aeroportoTresCancelamentos = json[2].mediaCancelamentos
          aeroportoQuatroNome = json[3].nomeAeroportoSaida
          aeroportoQuatroCancelamentos = json[3].mediaCancelamentos
          aeroportoCincoNome = json[4].nomeAeroportoSaida
          aeroportoCincoCancelamentos = json[4].mediaCancelamentos
          aeroportoSeisNome = json[5].nomeAeroportoSaida
          aeroportoSeisCancelamentos = json[5].mediaCancelamentos
          
        })
        
          }, 500);
 
        } else {
          throw "Houve um erro ao trazer dados!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  
    return false;
  
  }

  var isOpenEmp = false
  var isOpenUser = false

  function closeMod() {


    var navItem = document.getElementById('nav')
    var fechar = document.getElementById('botaoFechar')

    fechar.classList.remove('none')




    clos.classList.add('active')
    navItem.classList.remove('invi')

  }
  function fecharModals(){
    var fechar = document.getElementById('botaoFechar')
    fechar.classList.add('none')

    var navItem = document.getElementById('nav')
    var clos = document.getElementById('closeIcon')

    clos.classList.remove('active')
    navItem.classList.add('invi')


  }
  setInterval(() => {
    var clos = document.getElementById('closeIcon')
    if(clos.classList.value != 'close active')
    clos.classList.toggle('notification')

  }, 3000)

  function empHidden(){
    var caixaEmp = document.getElementById('empHidden')
  !isOpenEmp ? Crud(1) : mostrarModalCrud(0)
    caixaEmp.classList.toggle('dis')
    if(caixaEmp.classList.value == "hidden"){
   isOpenEmp = true

    } else {
   isOpenEmp = false


    }


  }
setTimeout(() => {
  console.log(tipoCargo)
 
  
}, 1000)
  var isOpenEmp = false
  var isOpenToken = false
  var isOpenUser = false

  function closeMod() {
    var fechar = document.getElementById('botaoFechar')
    fechar.classList.remove('none')

    var clos = document.getElementById('closeIcon')
    var navItem = document.getElementById('nav')
    clos.classList.add('active')
    navItem.classList.remove('invi')

    var navItem = document.getElementById('nav')
    navItem.classList.remove('invi')
  }
  setInterval(() => {
    var clos = document.getElementById('closeIcon')
    if(clos.classList.value != 'close active')
    clos.classList.toggle('notification')

  }, 2000)

  function empHidden(){
    var caixaEmp = document.getElementById('empHidden')
    
  !isOpenEmp ? mostrarModalCrud(1) : mostrarModalCrud(0)
    caixaEmp.classList.toggle('dis')
    if(caixaEmp.classList.value == "hidden"){
   isOpenEmp = true

    } else {
   isOpenEmp = false


    }


  }
  function tokenHidden(){
    var caixaEmp = document.getElementById('tokenHidden')
  !isOpenToken ? mostrarModalCrud(6) : mostrarModalCrud(0)
    caixaEmp.classList.toggle('dis')
    if(caixaEmp.classList.value == "hidden"){
   isOpenToken = true

    } else {
   isOpenToken = false


    }


  }

  function validarUsuario(){
      if(sessionStorage.ID_EMPRESA == 'null'){
            modalCinco();
      }
  }

  function puxarGraficos(){
    cancelamentosEmpresa()
    cancelamentosAeroporto()
    atrasosAeroportos()
    atrasosEmpresa()
      puxarDadosKPI()
    puxarDadosKPIAero()
    comoComprou()
    faixaEtaria()
  }
  cargo()




    function userHidden(){
!isOpenUser ? mostrarModalCrud(4) : mostrarModalCrud(0)

    var caixaUser = document.getElementById('userHidden')
    caixaUser.classList.toggle('dis')
    if(caixaUser.classList.value == "hidden"){
   isOpenUser = true

    } else {
   isOpenUser = false


    }
  }



var contUm = document.getElementById('conteudoUm')
var contQuatro = document.getElementById('conteudoQuatro')
var contDois = document.getElementById('conteudoDois')
var contEmpAdd = document.getElementById('cadEmp')
var contEmpEdit = document.getElementById('editEmp')
var contEmpDel = document.getElementById('delEmp')
var contUserEdit = document.getElementById('editUser')
var contUserDel = document.getElementById('delUser') 
var contTokenDel = document.getElementById('delToken')  
var contTokenAdd = document.getElementById('addToken')  
var contTokeneEdi = document.getElementById('ediToken') 
var contTokeneSelect = document.getElementById('selectToken')  
var contUm = document.getElementById('conteudoUm');
var contDois = document.getElementById('conteudoDois');
var contQuatro = document.getElementById('conteudoQuatro');
var contCinco = document.getElementById('conteudoSeis');
var botaoUm = document.getElementById('botaoUm')
var botaoDois = document.getElementById('botaoDois')
var botaoCinco = document.getElementById('botaoCinco')
var botaaoSeis = document.getElementById('botaoSeis')
isOpenEmp ? mostrarModalCrud(1) : mostrarModalCrud(0)
function mostrarModalCrud(modal) {
    // Oculta todos os modais
    contEmpAdd.classList.add('dis')
    contEmpEdit.classList.add('dis')
    contEmpDel.classList.add('dis')
    contUserDel.classList.add('dis')
    contUserEdit.classList.add('dis')
    contTokenAdd.classList.add('dis')
    contTokenDel.classList.add('dis')
    contTokeneEdi.classList.add('dis')
    contTokeneSelect.classList.add('dis')
    if (modal === 1) {
        contEmpAdd.classList.remove('dis');
  }
  if (modal === 2) {
        contEmpEdit.classList.remove('dis');
  }
  if (modal === 3) {
        contEmpDel.classList.remove('dis');
  }
  if (modal === 4) {
        contUserEdit.classList.remove('dis');
  }
  if (modal === 5) {
        contUserDel.classList.remove('dis');
  }
  if (modal === 6) {
        contTokenAdd.classList.remove('dis');
  }
  if (modal === 7) {
        contTokeneEdi.classList.remove('dis');
  }
  if (modal === 8) {
        contTokenDel.classList.remove('dis');
  }
  if (modal === 9) {
        contTokeneSelect.classList.remove('dis');
  }
}
mostrarModal(1)
function mostrarModal(modal) {
    // Oculta todos os modais
    contUm.classList.add('dis');
    contDois.classList.add('dis');
    contQuatro.classList.add('dis');
    contCinco.classList.add('dis');
    botaoUm.classList.add('inactive');
    botaoDois.classList.add('inactive');
    botaoCinco.classList.add('inactive');
    botaoSeis.classList.add('inactive');



   
    // Mostra apenas o modal escolhido
    if (modal === 1) {
        contUm.classList.remove('dis');
        botaoUm.classList.remove('inactive');
        const ctx = document.getElementById('myChart');
    const ctxDois = document.getElementById('myChartDois');
        
    setTimeout(() => {
  new Chart(ctx, {
  type: 'bar',
 data: {
  labels:  [empresaUmNome.slice(0, 4), empresaDoisNome.slice(0, 4), empresaTresNome.slice(0, 4), empresaQuatroNome.slice(0, 4), empresaCincoNome.slice(0, 4), empresaSeisNome.slice(0, 4)],
  datasets: [
    {
      label: 'Cancelamentos (%)',
      data: [empresaUmCancelamentos, empresaDoisCancelamentos, empresaTresCancelamentos, empresaQuatroCancelamentos, empresaCincoCancelamentos, empresaSeisCancelamentos],
      borderColor: 'red',
      backgroundColor: 'red',
    }
  ]
}
    });
    

new Chart(ctxDois, {
  type: 'bar',
 data: {
  labels:  [empresaAereaAtrasoNomeUm.slice(0, 4), empresaAereaAtrasoNomeDois.slice(0, 4), empresaAereaAtrasoNomeTres.slice(0, 4), empresaAereaAtrasoNomeQuatro.slice(0, 4), empresaAereaAtrasoNomeCinco.slice(0, 4), empresaAereaAtrasoNomeSeis.slice(0, 4)],
  datasets: [
    
  {
      label: 'Atrasos (%)',
      data:  [empresaUmAtrasos, empresaDoisAtrasos, empresaTresAtrasos, empresaQuatroAtrasos, empresaCincoAtrasos, empresaSeisAtrasos],
      borderColor: 'orange',
      backgroundColor: 'orange',
    }
  ]
}
    });
}, 2500)



const ctxTres = document.getElementById('myChartTres');


  

const ctxQuatro = document.getElementById('myChartQuatro');

setTimeout(() => {
  new Chart(ctxQuatro, {
  type: 'doughnut',
   data:{
  labels: [
    internet,
    lojaFisica,
    telefone
  ],
  datasets: [{
    label: 'Números:',
    data: [internetNumero, lojaFisicaNumero, telefoneNumero],
    backgroundColor: [
      'rgb(255, 99, 132)',
      'rgb(54, 162, 235)',
      'rgb(255, 205, 86)'
    ],
    hoverOffset: 4
  }]
   }
});
new Chart(ctxTres, {
  type: 'bar',
  data: {
    labels: [faixaEtariaUm.slice(6), faixaEtariaDois.slice(6),faixaEtariaTres.slice(6), faixaEtariaQuatro.slice(6), faixaEtariaCinco.slice(6)],
    datasets: [{
      label: 'Faixa etaria',
      data: [fxUm, fxDois, fxTres, fxQuatro, fxCinco],
      borderWidth: 2,
      backgroundColor: 'green',
    }]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true
      }
    }
  }
});
}, 3000)
       
    } else if (modal === 2) {
        contDois.classList.remove('dis');
        botaoDois.classList.remove('inactive');

   


    }
 
    else if (modal === 4) {
        contQuatro.classList.remove('dis');
    }
    else if (modal === 5) {
      botaoCinco.classList.remove('inactive');
        contCinco.classList.remove('dis');
    }
}

// Funções específicas para chamar o modal
function modalUm() {
    mostrarModal(1);
}

function modalDois() {
    mostrarModal(2);
}

function modalTres() {
    mostrarModal(3);
}

function modalQuatro() {
    mostrarModal(4);
}
function modalCinco() {
  if(tipoCargo == 'Funcionario'){
    hasASUDO = false
  } else {
    hasASUDO = true
  }
  if(hasASUDO){
    mostrarModal(5);

  } else {

    Swal.fire({
  icon: "error",
  title: "Oops...",
  text: "Você não tem permissão para acessar as configurações, fale com um administrador",
});
  }
}

function addEmp() {
    mostrarModalCrud(1);
    console.log('addEmp')

}
async function ediEmp() {
    mostrarModalCrud(2);
    console.log('ediEMp')

}
function delEmp() {
    mostrarModalCrud(3);
    console.log('delEMp')
}
function editUser() {
    mostrarModalCrud(4);
    console.log('ediUser')

}
function delUser() {
    mostrarModalCrud(5);
    console.log('delUser')

}
function addToken() {
    mostrarModalCrud(6);
    console.log('delUser')

}
function ediToken() {
    mostrarModalCrud(7);
    console.log('delUser')

}
function selectTokenMod() {
    mostrarModalCrud(9);

}
function delToken() {
    mostrarModalCrud(8);
    console.log('delUser')

}






document.getElementById('insertToken').addEventListener('click', function() {
    const destinatario = sessionStorage.getItem('EMAIL_USUARIO');
    console.log('Destinatário do sessionStorage:', destinatario); 
    // Enviar a requisição para o backend para obter o token
    fetch('http://localhost:3000/enviar-email', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ destinatario: destinatario }) 
    })
    .then(response => {
        console.log('Resposta do envio de e-mail:', response);  // Logando a resposta bruta
        return response.json(); // Espera a resposta em formato JSON
    })
    .then(data => {
        console.log('Dados do token recebidos:', data);  // Exibe os dados do token recebidos
        if (data.token) {
            // Pega o ID_EMPRESA do sessionStorage
            const idEmpresa = sessionStorage.getItem('ID_EMPRESA');
            const destinatario = sessionStorage.getItem('EMAIL_USUARIO');
            console.log('ID da empresa do sessionStorage:', idEmpresa);  // Logando o ID da empresa
            console.log("Token", data.token)
            console.log("Empresa", idEmpresa)
            
            // Envia o token e o ID_EMPRESA para o endpoint de cadastro de empresa
            fetch('./token/insertToken', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    tokenServer: data.token,
                    idEmpresaServer: idEmpresa
                })
            })
            .then(resposta => {
                console.log('Resposta do cadastro do token:', resposta);  // Logando a resposta bruta do cadastro
                return resposta.json();  // Espera a resposta em formato JSON
            })
            .then(cadastroData => {
                console.log('Cadastro do token realizado:', cadastroData);  // Logando os dados de sucesso do cadastro
          
                alert("Token Cadastrado com sucesso, verifique seu email!")

  
            })
            .catch(error => {
                console.error('Erro ao cadastrar o token:', error);
               
            });
        } else {
            console.error('Token não encontrado na resposta:', data);
            
        }
    })
    .catch(error => {
        console.error('Erro ao enviar e-mail:', error);
        
    });
});


function deletarToken() {
    const idEmpresa = sessionStorage.getItem('ID_EMPRESA');
    const codigoToken =  input_deleteToken.value;
    fetch(`./token/deleteToken`, {
      method: "POST",
      headers: {
          "Content-Type": "application/json"
      },
      
      body: JSON.stringify({      
        empresaServer: idEmpresa,
        codigoServer: codigoToken
  
    })
  }).then(function (resposta) {
      console.log("ESTOU NO THEN DO enviarForum()!")
  
      if (resposta.ok) {
          console.log(resposta);
          
          resposta.json().then(json => {
              console.log(json);
              console.log(JSON.stringify(json));
              // alert("Token deletado com sucesso!")

              mensagemm = 'Token deletado com sucesso!';
          exibirMsgErro(mensagemm);
  
               
          });
  
      } else {
          console.log("Houve um erro ao tentar realizar o enviarForum!");        
      }
    
  })
  }


  async function enviarPrompt(pergunta) {
      const saida = document.getElementById("saida").value;
      const destino = document.getElementById("destino").value;
      const prompt1 =  `Com base no histórico de voos entre ${saida} e ${destino}, quais são as chances de atrasos para diferentes companhias aéreas? Quais delas têm o melhor histórico de pontualidade`
      const prompt2 = `Qual a faixa etaria de pessoas que costumam fazer viagens aéreas para ${destino}`
      const prompt3 = `Quais empresas aéreas fazem o voo com a rota ${saida} para ${destino}`
      let prompt = ""
      switch (pergunta) {
        case 1:
          prompt = prompt1
          break;
        case 2:
          prompt = prompt2
          break
        case 3:
          prompt = prompt3
          break  
        default:
          break;
      }
      const respostaDiv = document.getElementById("resposta");

      // Limpa a resposta anterior
      respostaDiv.innerHTML = "Carregando...";

      try {
        // Faz a solicitação ao backend
        const response = await fetch("http://localhost:3001/api/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ prompt }),
        });

        if (!response.ok) {
          throw new Error("Erro ao obter resposta do servidor.");
        }

        const data = await response.json();

    
        respostaDiv.innerHTML = `<p><strong>Resposta:</strong> ${data.resposta}</p>`;
      } catch (error) {
        respostaDiv.innerHTML = `<p style="color: red;">Erro: ${error.message}</p>`;
      }
    }

    function selectToken() {
      const idEmpresa = sessionStorage.getItem('ID_EMPRESA');
      const codigoToken = input_selectToken.value;
      console.log("TESTEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE: " +codigoToken)
      fetch(`./token/selectToken`, {
      method: "post",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        codigoTokenServer: codigoToken,
        idEmpresaServer: idEmpresa
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
  
        if (resposta.ok) {
          mensagemm = 'Token info puxada com sucesso!';
          exibirMsgErro(mensagemm);
          alert(json.dataExpiracao)
          console.log(json.dataExpiracao)
            status =  json.statusToken
            expiration =  json.dataExpiracao
            console.log(status, expiration);
            
            



        } else {
          throw new Error("Houve um erro ao tentar atualiizar o token!");
        }
      })
      .catch(function (erro) {
        console.error("#ERRO: ", erro);
      });
    }



    function ativarToken(params) {
      const idEmpresa = sessionStorage.getItem('ID_EMPRESA');
      const codigoToken =  input_updateToken.value;
      fetch(`./token/updateToken`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        codigoTokenServer: codigoToken,
        idEmpresaServer: idEmpresa,
        statusServer: "Ativo"
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
  
        if (resposta.ok) {
          mensagemm = 'Token ativado com sucesso!';
          exibirMsgErro(mensagemm);
          // setTimeout(() => {
          //   alert("Token ativado com sucesso")
          // }, 1000);
        } else {
          throw new Error("Houve um erro ao tentar atualiizar o token!");
        }
      })
      .catch(function (erro) {
        console.error("#ERRO: ", erro);
      });
    }

    function desativarToken(params) {
      const idEmpresa = sessionStorage.getItem('ID_EMPRESA');
      const codigoToken =  input_updateToken.value;
      fetch(`./token/updateToken`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        codigoTokenServer: codigoToken,
        idEmpresaServer: idEmpresa,
        statusServer: "Inativo"
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
  
        if (resposta.ok) {
          mensagemm = 'Token inativo!';
          exibirMsgErro(mensagemm);
          // setTimeout(() => {
          //   alert("Token inativo ")
          // }, 1000);
        } else {
          throw new Error("Houve um erro ao tentar atualiizar o token!");
        }
      })
      .catch(function (erro) {
        console.error("#ERRO: ", erro);
      });
    }
    




function climaAPI(params) {
  const chaveApi = '61a63f60759671b91f52c72ecfa66019';
const saidaClima = document.getElementById("input_saida_clima").value;
const destinoClima = document.getElementById("input_destino_clima").value;

const traducoesTempo = {
    "clear sky": "céu limpo",
    "few clouds": "poucas nuvens",
    "scattered clouds": "nuvens dispersas",
    "broken clouds": "nuvens quebradas",
    "shower rain": "chuva rápida",
    "rain": "chuva",
    "thunderstorm": "tempestade",
    "snow": "neve",
    "mist": "neblina",
    "drizzle": "chuvisco",
    "light rain": "chuva leve",
    "overcast clouds": "nuvens cobertas",
    "moderate rain": "chuva moderada"
};

const obterPrevisao = () => {
    const urlPrevisao = `https://api.openweathermap.org/data/2.5/forecast?q=${saidaClima}&appid=${chaveApi}&units=metric`;

    return fetch(urlPrevisao)
        .then(resposta => {
            if (!resposta.ok) {
                throw new Error('Erro na requisição da previsão: ' + resposta.status);
            }
            return resposta.json();
        });
};

const obterClimaAtualSaida = () => {
    const urlClimaAtual = `https://api.openweathermap.org/data/2.5/weather?q=${saidaClima}&appid=${chaveApi}&units=metric`;

    return fetch(urlClimaAtual)
        .then(resposta => {
            if (!resposta.ok) {
                throw new Error('Erro na requisição do clima atual: ' + resposta.status);
            }
            return resposta.json();
        });
};

document.getElementById("saida1").classList.add("card-inicial")
document.getElementById("saida2").classList.add("card-inicial")
document.getElementById("saida3").classList.add("card-inicial")
document.getElementById("saida4").classList.add("card-inicial")
document.getElementById("saida5").classList.add("card-inicial")

document.getElementById("destino1").classList.add("card-inicial")
document.getElementById("destino2").classList.add("card-inicial")
document.getElementById("destino3").classList.add("card-inicial")
document.getElementById("destino4").classList.add("card-inicial")
document.getElementById("destino5").classList.add("card-inicial")

Promise.all([obterPrevisao(), obterClimaAtualSaida()])
    .then(([dadosPrevisao, dadosClimaAtual]) => {
        let resultado = `<h2>Previsão do Tempo em ${saidaClima}</h2>`;
        
        // Filtra as previsões para as 15:00h (15:00:00)
        const previsoesDiarias = dadosPrevisao.list.filter(item => item.dt_txt.endsWith('15:00:00')).slice(0, 5);
        
        // Preenche as divs existentes para cada dia
        previsoesDiarias.forEach((dia, index) => {
            const data = new Date(dia.dt * 1000);
            const dataFormatada = `${data.getDate().toString().padStart(2, '0')}/${(data.getMonth() + 1).toString().padStart(2, '0')}`;
            const temperatura = dia.main.temp;
            const descricaoTempo = dia.weather[0].description;
            const descricaoTraduzida = traducoesTempo[descricaoTempo] || descricaoTempo;
            const umidade = dia.main.humidity; 
            const velocidadeVento = (dia.wind.speed * 3.6).toFixed(2);
            const icone = dia.weather[0].icon;

            // Aqui, preenchendo as divs já existentes no front-end
            document.getElementById(`saida${index + 1}`).innerHTML = `
              <div class="card-header-previsao-do-tempo">
                <h4>${dataFormatada}</h4><br>
              </div>
              <div class="card-main-content-previsao-do-tempo">
                <div class="half-width">
                  <img src="https://openweathermap.org/img/wn/${icone}.png" alt="Ícone do tempo">
                </div>
                <div class="half-width">
                  <p><strong>Clima:</strong> ${temperatura}°C</p>
                </div>  
              </div><br>
              <div class="card-secundary-content-previsao-do-tempo">
                <div class="card-divide-box">
                  <div class="half-width right-line">
                    <div class="half-width half-header-content">
                      <strong class="content">Condição:</strong>
                    </div>
                    <div class="half-width half-content">
                      <p class="content">${descricaoTraduzida}</p><br>                    
                    </div>
                  </div>
                  <div class="half-width">
                    <div class="half-width half-header-content">
                      <strong class="content">Umidade:</strong>
                    </div>
                    <div class="half-width half-content">
                      <p class="content">${umidade}%</p>
                    </div>
                  </div>
                </div>
                
                <p><strong class="content">Velocidade do Vento:</strong></p>
                <p class="content">${velocidadeVento} km/h</p>
              </div>   
            `;
        });

    })
    .catch(erro => {
        console.error('Erro:', erro);
        document.getElementById('divClima').innerHTML = 'Erro ao buscar dados do tempo.';
    });






      // DESTINO



    const obterPrevisao2 = () => {
    const urlPrevisao = `https://api.openweathermap.org/data/2.5/forecast?q=${destinoClima}&appid=${chaveApi}&units=metric`;

    return fetch(urlPrevisao)
        .then(resposta => {
            if (!resposta.ok) {
                throw new Error('Erro na requisição da previsão: ' + resposta.status);
            }
            return resposta.json();
        });
};

const obterClimaAtualDestino = () => {
    const urlClimaAtual = `https://api.openweathermap.org/data/2.5/weather?q=${destinoClima}&appid=${chaveApi}&units=metric`;

    return fetch(urlClimaAtual)
        .then(resposta => {
            if (!resposta.ok) {
                throw new Error('Erro na requisição do clima atual: ' + resposta.status);
            }
            return resposta.json();
        });
};

Promise.all([obterPrevisao2(), obterClimaAtualDestino()])
    .then(([dadosPrevisao, dadosClimaAtual]) => {
        let resultado = `<h2>Previsão do Tempo em ${destinoClima}</h2>`;
        
        const previsoesDiarias = dadosPrevisao.list.filter(item => item.dt_txt.endsWith('15:00:00')).slice(0, 5);
        
        // Preenche as divs existentes para cada dia
        previsoesDiarias.forEach((dia, index) => {
            const data = new Date(dia.dt * 1000);
            const dataFormatada = `${data.getDate().toString().padStart(2, '0')}/${(data.getMonth() + 1).toString().padStart(2, '0')}`;
            const temperatura = dia.main.temp;
            const descricaoTempo = dia.weather[0].description;
            const descricaoTraduzida = traducoesTempo[descricaoTempo] || descricaoTempo;
            const velocidadeVento = (dia.wind.speed * 3.6).toFixed(2);
            const umidade = dia.main.humidity; 
            const icone = dia.weather[0].icon;

            

            // Aqui, preenchendo as divs já existentes no front-end
            document.getElementById(`destino${index + 1}`).innerHTML = `
                <div class="card-header-previsao-do-tempo">
                <h4>${dataFormatada}</h4><br>
              </div>
              <div class="card-main-content-previsao-do-tempo">
                <div class="half-width">
                  <img src="https://openweathermap.org/img/wn/${icone}.png" alt="Ícone do tempo">
                </div>
                <div class="half-width">
                  <p><strong>Clima:</strong> ${temperatura}°C</p>
                </div>
              </div>
              <div class="card-secundary-content-previsao-do-tempo">
                <div class="card-divide-box">
                  <div class="half-width right-line">
                    <div class="half-width half-header-content">
                      <strong class="content">Condição:</strong>
                    </div>
                    <div class="half-width half-content">
                      <p class="content">${descricaoTraduzida}</p><br>
                    </div>
                  </div>
                  <div class="half-width">
                    <div class="half-width half-header-content">
                      <strong class="content">Umidade:</strong>
                    </div>
                    <div class="half-width half-content">
                      <p class="content">${umidade}%</p>
                    </div>
                  </div>
                </div>

                <p><strong class="content">Velocidade do Vento:</strong></p>
                <p class="content">${velocidadeVento} km/h</p>
              </div>
            `;
        });

    })
    .catch(erro => {
        console.error('Erro:', erro);
        document.getElementById('divClima').innerHTML = 'Erro ao buscar dados do tempo.';
    });


  
}

//comentar abaixo
function exibirMsgErro(mensagem) {
    const textoDentro = document.getElementById('textoDentro');
    textoDentro.innerHTML = mensagem;
    alter();
  }

  function alter(){
    const notificacao = document.getElementById('alertaNotify');
          notificacao.style.display = 'flex';
          notificacao.style.animation = 'deslizarbaixo 1s ease-out forwards';

          setTimeout(() => {
              notificacao.style.animation = 'deslizarcima 1s ease-out forwards';
              setTimeout(() => {
                  notificacao.style.display = 'none';
              }, 1000);
          }, 2000);
  
  }


</script>

