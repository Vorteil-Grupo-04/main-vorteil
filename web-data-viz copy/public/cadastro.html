<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    nome<input type="text" id="input_nome"> <br>
    cpf <input type="text" id="input_cpf"> <br> 
    email <input type="text" id="input_email"> <br> 
    senha <input type="password" id="input_senha"> <br>
    Confirmar Senha <input type="password" id="input_senha"><br>


    <button onclick="btnCadastro()">entrar</button> <br>
    <button onclick="btnRedefinirSenha()"></button>
</body>
</html>



<script>

function exibirMsgErro(mensagem) {
    alert(mensagem)
  }

function validarNome(params) {
    let nome = input_nome.value;
    let mensagemNome = "";
    if (nome.length > 20){
        mensagemNome = 'O nome não pode ter mais de 20 caracteres.';
        exibirMsgErro(mensagemNome)
    }else{
        return true;
    } 

}

function validarEmail() {
      let email = input_email.value;
      let mensagemEmail = '';
      let emailCom = email.endsWith('.com');
      let emailArroba = email.indexOf("@");
      if (emailCom == false || emailArroba == -1) {
          mensagemEmail = 'Email inválido';
          exibirMsgErro(mensagemEmail)
      } else {
          return true;
      }
  }
  
  
  
  function validarSenha() {
      let senha = input_password.value;
      let confirmarSenha = input_confirm.value;
      let mensagemSenha = '';
  
      if (confirmarSenha != senha) {         
          mensagemSenha = 'Os campos de senha precisam ser iguais.';
          exibirMsgErro(mensagemSenha);
      }else if (!/[A-Z]/.test(senha)) {
          mensagemSenha = 'Senha deve conter pelo menos uma letra maiúscula.';
          exibirMsgErro(mensagemSenha);
      }
      else if (!/[a-z]/.test(senha)) {
          mensagemSenha = 'Senha deve conter pelo menos uma letra minúscula.';
          exibirMsgErro(mensagemSenha);
      }
      else if (senha.length < 8) {
          mensagemSenha = 'Senha deve ter no mínimo 8 caracteres.';
          exibirMsgErro(mensagemSenha);
      }
      else {
          return true;
      }
  }
  


//   function entrarLogin() {

//     var email_input = input_email_log.value;
//     var senha_input = input_password_log.value;
    
//     if (email_input == "" || senha_input == "") {
//         return false;
//     }
    
    
//     console.log("FORM LOGIN: ", email_input);
//     console.log("FORM SENHA: ", senha_input);
    
//     fetch("./usuarios/autenticar", {
//         method: "POST",
//         headers: {
//             "Content-Type": "application/json"
//         },
//         body: JSON.stringify({
//             emailServer: email_input,
//             senhaServer: senha_input
//         })
//     }).then(function (resposta) {
//         console.log("ESTOU NO THEN DO entrar()!")
    
//         if (resposta.ok) {
//             console.log(resposta);
     
        
//             resposta.json().then(json => {
//                 console.log(json);
//                 console.log(JSON.stringify(json));
//                 sessionStorage.EMAIL_USUARIO = json.email;
//                 sessionStorage.NOME_USUARIO = json.nome;
//                 sessionStorage.ID_USUARIO = json.id;
//                 sessionStorage.FOTO_USUARIO = json.foto;
//                 sessionStorage.DOBRA_USUARIO = json.dobra;

                
              
//                 setTimeout(function () {
//                   window.location = "/indexLogado.html";
//                 }, 1000); // apenas para exibir o loading
//             });
    
//         } else {
    
//             console.log("Houve um erro ao tentar realizar o login!");
    
            
//         }
    
//     }).catch(function (erro) {
//         console.log(erro);
//     })
    
//     return false;
//     }

  function cadastrar() {
    let emailValido = validarEmail();
    let senhaValida = validarSenha();
    let nomeValido = validarNome()

    if (!emailValido || !senhaValida || !nomeValido) {
      return false;
  }

    const nome_input  = input_nome.value;
    const cpf_input = input_cpf.value;
    const email_input = input_email.value;
    const senha_input = input_senha.value;
    const confirmacao_senha_input = input_confirm.value;

          
    console.log(nome_input)
    console.log(cpf_input)
    console.log(email_input)
    console.log(senha_input)
    console.log(confirmacao_senha_input)
  
  
    if (
      nome_input == "" ||
      email_input == "" ||
      cpf_input == "" ||
      senha_input == "" ||
      confirmacao_senha_input == "" 
    ) {
      return false;
    }
  
    fetch("./usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        nomeServer: nome_input,
        cpfServer: cpf_input,
        emailServer: email_input,
        senhaServer: senha_input,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);
  
        if (resposta.ok) {
          setTimeout(() => {
            window.location = "cadastro.html";
          }, "2000");
  
  
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  
    return false;
  
    }



  

</script>